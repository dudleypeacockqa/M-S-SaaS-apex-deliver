============================= test session starts =============================
platform win32 -- Python 3.11.9, pytest-7.4.3, pluggy-1.6.0
rootdir: C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver
configfile: pytest.ini
plugins: anyio-3.7.1, asyncio-0.21.1, cov-7.0.0
asyncio: mode=Mode.STRICT
collected 801 items

tests\test_additional_ratios.py ...............                          [  1%]
tests\test_api_middleware.py ...............                             [  3%]
tests\test_audio_chunking_service.py .................                   [  5%]
tests\test_auth_helpers.py ....................                          [  8%]
tests\test_billing_endpoints.py ..............                           [ 10%]
tests\test_billing_simple.py ...                                         [ 10%]
tests\test_clerk_auth_complete.py ..........................             [ 13%]
tests\test_database_reset.py ..                                          [ 13%]
tests\test_deal_endpoints.py .........................                   [ 17%]
tests\test_deal_matching_api.py ................                         [ 19%]
tests\test_deal_matching_models.py ........                              [ 20%]
tests\test_deal_matching_service.py ...............                      [ 21%]
tests\test_document_endpoints.py ....................................... [ 26%]
                                                                         [ 26%]
tests\test_document_service.py ....                                      [ 27%]
tests\test_entitlement.py ...........................................    [ 32%]
tests\test_financial_api.py ........................                     [ 35%]
tests\test_financial_models_sync.py ..........                           [ 36%]
tests\test_financial_narrative_service.py ...........                    [ 38%]
tests\test_financial_ratios.py ...........................               [ 41%]
tests\test_financial_xero_integration.py s                               [ 41%]
tests\test_master_admin_api.py .............                             [ 43%]
tests\test_master_admin_models.py .....ss..........ss..s.                [ 46%]
tests\test_models_financial_connection.py ......                         [ 47%]
tests\test_netsuite_integration.py ssssssssss                            [ 48%]
tests\test_organization_service.py .....                                 [ 48%]
tests\test_path_safety.py ...                                            [ 49%]
tests\test_pipeline_template_api.py ...                                  [ 49%]
tests\test_pipeline_template_schemas.py ....                             [ 50%]
tests\test_podcast_api.py .............................................. [ 55%]
........                                                                 [ 56%]
tests\test_podcast_service.py ...........                                [ 58%]
tests\test_quickbooks_integration.py sssssssss                           [ 59%]
tests\test_quota_service.py .............................                [ 63%]
tests\test_rbac.py ..........                                            [ 64%]
tests\test_s3_storage_service.py sssssssssssssssssssss                   [ 66%]
tests\test_sage_integration.py sssssssss                                 [ 68%]
tests\test_storage_factory.py .s..s                                      [ 68%]
tests\test_subscription.py .................                             [ 70%]
tests\test_subscription_error_paths.py ............ssss....              [ 73%]
tests\test_subscription_model.py .............                           [ 74%]
tests\test_subscription_service_edge_cases.py .......................    [ 77%]
tests\test_task_automation.py .....                                      [ 78%]
tests\test_task_crud.py ......                                           [ 79%]
tests\test_thumbnail_service.py ................                         [ 81%]
tests\test_valuation_api.py ..................                           [ 83%]
tests\test_valuation_crud.py .................                           [ 85%]
tests\test_valuation_service.py .................................        [ 89%]
tests\test_xero_integration.py sssssssss                                 [ 90%]
tests\test_xero_oauth_service.py ...........                             [ 92%]
tests\test_youtube_service.py ...                                        [ 92%]
tests\api\test_blog.py ................                                  [ 94%]
tests\api\test_blog_api.py ......                                        [ 95%]
tests\api\test_document_sharing.py ........                              [ 96%]
tests\api\test_marketing.py ....                                         [ 96%]
tests\services\test_rbac_permissions.py .........sss..s                  [ 98%]
tests\test_migrations\test_user_foreign_keys.py ...sss.....              [100%]

============================== warnings summary ===============================
tests\test_netsuite_integration.py:30
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_netsuite_integration.py:30: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_netsuite_integration.py:42
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_netsuite_integration.py:42: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_netsuite_integration.py:59
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_netsuite_integration.py:59: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_netsuite_integration.py:97
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_netsuite_integration.py:97: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_netsuite_integration.py:114
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_netsuite_integration.py:114: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_netsuite_integration.py:132
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_netsuite_integration.py:132: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_netsuite_integration.py:153
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_netsuite_integration.py:153: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_netsuite_integration.py:209
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_netsuite_integration.py:209: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_netsuite_integration.py:229
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_netsuite_integration.py:229: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_netsuite_integration.py:249
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_netsuite_integration.py:249: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_quickbooks_integration.py:29
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_quickbooks_integration.py:29: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_quickbooks_integration.py:49
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_quickbooks_integration.py:49: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_quickbooks_integration.py:66
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_quickbooks_integration.py:66: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_quickbooks_integration.py:104
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_quickbooks_integration.py:104: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_quickbooks_integration.py:121
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_quickbooks_integration.py:121: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_quickbooks_integration.py:143
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_quickbooks_integration.py:143: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_quickbooks_integration.py:164
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_quickbooks_integration.py:164: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_quickbooks_integration.py:219
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_quickbooks_integration.py:219: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_quickbooks_integration.py:238
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_quickbooks_integration.py:238: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_sage_integration.py:28
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_sage_integration.py:28: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_sage_integration.py:40
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_sage_integration.py:40: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_sage_integration.py:57
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_sage_integration.py:57: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_sage_integration.py:95
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_sage_integration.py:95: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_sage_integration.py:112
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_sage_integration.py:112: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_sage_integration.py:130
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_sage_integration.py:130: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_sage_integration.py:151
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_sage_integration.py:151: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_sage_integration.py:206
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_sage_integration.py:206: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_sage_integration.py:226
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_sage_integration.py:226: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_xero_integration.py:30
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_xero_integration.py:30: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_xero_integration.py:47
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_xero_integration.py:47: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_xero_integration.py:63
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_xero_integration.py:63: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_xero_integration.py:104
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_xero_integration.py:104: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_xero_integration.py:136
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_xero_integration.py:136: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_xero_integration.py:153
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_xero_integration.py:153: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_xero_integration.py:175
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_xero_integration.py:175: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_xero_integration.py:196
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_xero_integration.py:196: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests\test_xero_integration.py:284
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\tests\test_xero_integration.py:284: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

backend/tests/test_billing_endpoints.py: 14 warnings
backend/tests/test_billing_simple.py: 3 warnings
backend/tests/test_clerk_auth_complete.py: 26 warnings
backend/tests/test_deal_endpoints.py: 25 warnings
backend/tests/test_deal_matching_api.py: 16 warnings
backend/tests/test_document_endpoints.py: 39 warnings
backend/tests/test_financial_api.py: 24 warnings
backend/tests/test_master_admin_api.py: 13 warnings
backend/tests/test_pipeline_template_api.py: 3 warnings
backend/tests/test_podcast_api.py: 54 warnings
backend/tests/test_subscription_error_paths.py: 16 warnings
backend/tests/test_task_crud.py: 6 warnings
backend/tests/test_valuation_api.py: 18 warnings
backend/tests/test_valuation_crud.py: 8 warnings
backend/tests/api/test_blog.py: 16 warnings
backend/tests/api/test_blog_api.py: 6 warnings
backend/tests/api/test_document_sharing.py: 8 warnings
backend/tests/api/test_marketing.py: 4 warnings
  C:\Users\User\AppData\Local\Programs\Python\Python311\Lib\site-packages\httpx\_client.py:680: DeprecationWarning: The 'app' shortcut is now deprecated. Use the explicit style 'transport=WSGITransport(app=...)' instead.
    warnings.warn(message, DeprecationWarning)

backend/tests/test_clerk_auth_complete.py: 24 warnings
  C:\Users\User\AppData\Local\Programs\Python\Python311\Lib\site-packages\httpx\_content.py:202: DeprecationWarning: Use 'content=<...>' to upload raw bytes/text content.
    warnings.warn(message, DeprecationWarning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=============================== tests coverage ================================
_______________ coverage: platform win32, python 3.11.9-final-0 _______________

Name                                          Stmts   Miss  Cover   Missing
---------------------------------------------------------------------------
app\__init__.py                                   1      0   100%
app\api\__init__.py                              21      0   100%
app\api\dependencies\__init__.py                  0      0   100%
app\api\dependencies\auth.py                    101      0   100%
app\api\dependencies\rbac.py                      2      2     0%   7-13
app\api\document_sharing.py                     121     10    92%   63, 124, 158, 191, 199, 203, 222, 251, 301, 336
app\api\routes\__init__.py                        2      0   100%
app\api\routes\auth.py                            9      0   100%
app\api\routes\blog.py                           55      0   100%
app\api\routes\dashboard.py                      25      7    72%   37-44, 81, 100, 119
app\api\routes\deal_matching.py                  77      5    94%   33, 138-139, 150-160
app\api\routes\deals.py                          64     10    84%   113, 131-146, 171, 204
app\api\routes\documents.py                     174     47    73%   71-72, 86-91, 117, 139, 171, 235, 273, 360-388, 404-429, 450, 489, 508-509, 539-558, 573-591, 619, 652-672, 717, 797-808
app\api\routes\financial.py                     151     26    83%   92, 108, 167, 174, 224, 230, 288, 294, 354, 405, 414, 420, 477, 483, 542, 572, 580, 586, 622, 628, 656, 662, 712, 718, 768, 774
app\api\routes\marketing.py                      69     11    84%   52-56, 99, 149-152, 198-201
app\api\routes\master_admin.py                  379     37    90%   145, 187, 282, 304, 329, 437, 624, 644, 711, 732, 818, 838, 858, 882, 885, 893-894, 912, 937, 946, 971, 980, 1040, 1059, 1079, 1139-1145, 1160, 1180, 1267, 1287, 1307, 1392, 1412, 1433
app\api\routes\pipeline_templates.py             34      0   100%
app\api\routes\podcasts.py                      306     80    74%   51-135, 178-179, 184-189, 242, 327-329, 377, 449, 468, 509-515, 550, 557, 576, 635-641, 675, 699, 790, 833, 840, 906, 945-951, 1003-1004
app\api\routes\subscriptions.py                  99      6    94%   221-224, 239-240
app\api\routes\tasks.py                          69     26    62%   109, 127-133, 154-158, 184-199, 212-217, 232-273, 286-291
app\api\routes\valuation.py                     129     28    78%   57-63, 87, 89, 147-149, 182-184, 217-219, 272-274, 291-293, 308-323, 394-401
app\api\webhooks\__init__.py                      0      0   100%
app\api\webhooks\clerk.py                        52      4    92%   20, 54-55, 61
app\core\__init__.py                              0      0   100%
app\core\config.py                               44      0   100%
app\core\database.py                             30     17    43%   23-27, 32-41, 46-47, 53
app\core\security.py                             23      1    96%   38
app\core\subscription.py                         52      7    87%   29, 140-146
app\db\__init__.py                                0      0   100%
app\db\base.py                                    3      0   100%
app\db\session.py                                 3      0   100%
app\db\types.py                                  11      1    91%   22
app\main.py                                      27      3    89%   26, 61, 71
app\models\__init__.py                           20      0   100%
app\models\blog_post.py                          25      1    96%   32
app\models\contact_message.py                    16      1    94%   23
app\models\deal.py                               56      0   100%
app\models\deal_match.py                         71      5    93%   56, 61, 100, 105, 133
app\models\document.py                          107      5    95%   60, 123, 164, 199, 237
app\models\enums.py                              65      0   100%
app\models\financial_connection.py               27      1    96%   52
app\models\financial_narrative.py                34      0   100%
app\models\financial_ratio.py                    67      0   100%
app\models\financial_statement.py                80      1    99%   134
app\models\master_admin.py                      272     14    95%   88, 115, 141, 167, 194, 235, 266, 303, 332, 373, 400, 437, 470, 494
app\models\newsletter_subscription.py            12      1    92%   21
app\models\organization.py                       18      0   100%
app\models\pipeline_template.py                  30      0   100%
app\models\podcast.py                            49      0   100%
app\models\podcast_usage.py                      15      1    93%   36
app\models\rbac_audit_log.py                     25      0   100%
app\models\subscription.py                       54      0   100%
app\models\task.py                               68      0   100%
app\models\user.py                               43      0   100%
app\models\valuation.py                         115      0   100%
app\schemas\__init__.py                           3      0   100%
app\schemas\deal.py                              40      0   100%
app\schemas\deal_match.py                        68      0   100%
app\schemas\document.py                         183      5    97%   19, 33, 153, 249, 251
app\schemas\financial.py                         79      0   100%
app\schemas\master_admin.py                     420      0   100%
app\schemas\pipeline_template.py                 53      2    96%   34, 40
app\schemas\podcast.py                           52      0   100%
app\schemas\subscription.py                      89      0   100%
app\schemas\task.py                              88      0   100%
app\schemas\user.py                              33      0   100%
app\schemas\valuation.py                        243      5    98%   31, 39, 186-188
app\services\__init__.py                          6      0   100%
app\services\audio_chunking_service.py          102     21    79%   130-133, 140-150, 182, 186-188, 268-269, 281-283
app\services\deal_matching_service.py           161     14    91%   106, 116, 139, 141, 162, 178, 210, 266, 269, 276, 283, 288, 294, 309
app\services\deal_service.py                     81     15    81%   99-100, 120-121, 158, 178-186, 203, 228
app\services\document_service.py                514    121    76%   53, 66, 106, 122, 149-157, 177, 196, 226, 231, 241-280, 290, 327, 333, 372, 378, 474, 564, 595, 633-666, 700, 704, 709-718, 745, 749, 767, 781, 830-832, 842-877, 886-898, 917, 930-932, 967-977, 1007, 1027, 1079, 1085, 1098-1099, 1154-1171, 1198, 1213, 1311, 1373, 1382, 1498, 1510-1512, 1517-1519, 1532-1536, 1547-1549, 1618-1620
app\services\entitlement_service.py              47      4    91%   184, 202, 246-247
app\services\financial_narrative_service.py     231     20    91%   40, 53-61, 227-228, 300-313, 328, 342, 352, 372, 381, 385
app\services\financial_ratios.py                240     10    96%   248, 714, 728, 754, 801, 808, 815, 822, 829, 882
app\services\invite_service.py                   31     31     0%   2-78
app\services\master_admin_service.py            435     25    94%   145, 147, 149, 217, 219, 247, 249, 251, 257, 668, 670-671, 963, 965, 1078, 1143, 1244, 1360, 1362, 1484, 1486, 1488, 1614, 1616-1617
app\services\netsuite_oauth_service.py          138    138     0%   9-547
app\services\organization_service.py             64      3    95%   35, 44, 69
app\services\pipeline_template_service.py        39      0   100%
app\services\podcast_service.py                 115     11    90%   16-18, 118, 131, 133, 135, 181, 197, 232, 312
app\services\quickbooks_oauth_service.py        233    183    21%   24-28, 40-234, 252, 263, 273, 284, 298, 308-314, 320, 338-350, 381-441, 459-487, 504-557, 572-607, 622-686, 730
app\services\quota_service.py                   165     13    92%   115, 128, 141, 168, 171, 176-187, 211, 259
app\services\rbac_audit_service.py               20      0   100%
app\services\s3_storage_service.py               95     95     0%   2-323
app\services\sage_oauth_service.py              192    192     0%   9-646
app\services\storage_service.py                  65     14    78%   138-142, 164, 186, 203-204, 224-227, 251-252
app\services\subscription_service.py            134     22    84%   282-292, 305-316, 328-339, 351-354
app\services\task_service.py                     35      2    94%   15-16
app\services\task_template_service.py            61     43    30%   22-33, 41-42, 51-54, 65-79, 88-92, 101-104, 112, 125-137, 146-151, 161-166, 176-195
app\services\thumbnail_service.py                93     14    85%   108, 119-120, 147, 158, 174-176, 200, 229-231, 298-299
app\services\user_service.py                     75      7    91%   50, 54, 86, 90, 100, 110, 116
app\services\valuation_service.py               318     19    94%   192, 215, 364, 373-374, 399, 420, 506, 511, 701, 717, 815, 840, 861, 867, 903, 916, 920, 926
app\services\xero_oauth_service.py              206     71    66%   24-28, 42-187, 196, 205, 216, 224, 229-235, 241, 315, 324, 342-351, 395, 440, 470-471, 518-519, 552-554
app\services\youtube_service.py                  57     15    74%   12, 85, 113-114, 121, 131, 146-162
app\tasks\__init__.py                             2      0   100%
app\tasks\task_automation.py                     25      0   100%
app\utils\__init__.py                             0      0   100%
app\utils\datetime.py                             4      0   100%
---------------------------------------------------------------------------
TOTAL                                          8737   1473    83%
=========================== short test summary info ===========================
SKIPPED [1] tests\test_financial_xero_integration.py:9: To be implemented in ratio engine phase
SKIPPED [1] tests\test_master_admin_models.py:134: SQLite doesn't enforce enum constraints - test with PostgreSQL
SKIPPED [1] tests\test_master_admin_models.py:148: SQLite doesn't enforce enum constraints - test with PostgreSQL
SKIPPED [1] tests\test_master_admin_models.py:335: SQLite doesn't enforce enum constraints - test with PostgreSQL
SKIPPED [1] tests\test_master_admin_models.py:348: SQLite doesn't enforce enum constraints - test with PostgreSQL
SKIPPED [1] tests\test_master_admin_models.py:405: SQLite doesn't enforce enum constraints - test with PostgreSQL
SKIPPED [1] tests\test_netsuite_integration.py:30: NetSuite credentials not configured (set NETSUITE_CLIENT_ID, NETSUITE_CLIENT_SECRET, NETSUITE_ACCOUNT_ID)
SKIPPED [1] tests\test_netsuite_integration.py:42: NetSuite credentials not configured (set NETSUITE_CLIENT_ID, NETSUITE_CLIENT_SECRET, NETSUITE_ACCOUNT_ID)
SKIPPED [1] tests\test_netsuite_integration.py:59: NetSuite credentials not configured (set NETSUITE_CLIENT_ID, NETSUITE_CLIENT_SECRET, NETSUITE_ACCOUNT_ID)
SKIPPED [1] tests\test_netsuite_integration.py:97: NetSuite credentials not configured (set NETSUITE_CLIENT_ID, NETSUITE_CLIENT_SECRET, NETSUITE_ACCOUNT_ID)
SKIPPED [1] tests\test_netsuite_integration.py:114: NetSuite credentials not configured (set NETSUITE_CLIENT_ID, NETSUITE_CLIENT_SECRET, NETSUITE_ACCOUNT_ID)
SKIPPED [1] tests\test_netsuite_integration.py:132: NetSuite credentials not configured (set NETSUITE_CLIENT_ID, NETSUITE_CLIENT_SECRET, NETSUITE_ACCOUNT_ID)
SKIPPED [1] tests\test_netsuite_integration.py:153: NetSuite credentials not configured (set NETSUITE_CLIENT_ID, NETSUITE_CLIENT_SECRET, NETSUITE_ACCOUNT_ID)
SKIPPED [1] tests\test_netsuite_integration.py:209: NetSuite credentials not configured (set NETSUITE_CLIENT_ID, NETSUITE_CLIENT_SECRET, NETSUITE_ACCOUNT_ID)
SKIPPED [1] tests\test_netsuite_integration.py:229: NetSuite credentials not configured (set NETSUITE_CLIENT_ID, NETSUITE_CLIENT_SECRET, NETSUITE_ACCOUNT_ID)
SKIPPED [1] tests\test_netsuite_integration.py:249: Requires real NetSuite sandbox OAuth flow - manual test
SKIPPED [1] tests\test_quickbooks_integration.py:29: QuickBooks credentials not configured (set QUICKBOOKS_CLIENT_ID and QUICKBOOKS_CLIENT_SECRET)
SKIPPED [1] tests\test_quickbooks_integration.py:49: QuickBooks credentials not configured (set QUICKBOOKS_CLIENT_ID and QUICKBOOKS_CLIENT_SECRET)
SKIPPED [1] tests\test_quickbooks_integration.py:66: QuickBooks credentials not configured (set QUICKBOOKS_CLIENT_ID and QUICKBOOKS_CLIENT_SECRET)
SKIPPED [1] tests\test_quickbooks_integration.py:104: QuickBooks credentials not configured (set QUICKBOOKS_CLIENT_ID and QUICKBOOKS_CLIENT_SECRET)
SKIPPED [1] tests\test_quickbooks_integration.py:121: QuickBooks credentials not configured (set QUICKBOOKS_CLIENT_ID and QUICKBOOKS_CLIENT_SECRET)
SKIPPED [1] tests\test_quickbooks_integration.py:143: QuickBooks credentials not configured (set QUICKBOOKS_CLIENT_ID and QUICKBOOKS_CLIENT_SECRET)
SKIPPED [1] tests\test_quickbooks_integration.py:164: QuickBooks credentials not configured (set QUICKBOOKS_CLIENT_ID and QUICKBOOKS_CLIENT_SECRET)
SKIPPED [1] tests\test_quickbooks_integration.py:219: QuickBooks credentials not configured (set QUICKBOOKS_CLIENT_ID and QUICKBOOKS_CLIENT_SECRET)
SKIPPED [1] tests\test_quickbooks_integration.py:238: Requires real QuickBooks sandbox OAuth flow - manual test
SKIPPED [1] tests\test_s3_storage_service.py:32: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:54: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:68: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:86: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:109: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:136: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:164: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:194: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:219: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:249: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:273: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:304: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:330: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:355: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:381: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:406: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:433: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:465: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:497: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:516: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_s3_storage_service.py:535: boto3 not installed (optional S3/R2 storage dependency)
SKIPPED [1] tests\test_sage_integration.py:28: Sage credentials not configured (set SAGE_CLIENT_ID and SAGE_CLIENT_SECRET)
SKIPPED [1] tests\test_sage_integration.py:40: Sage credentials not configured (set SAGE_CLIENT_ID and SAGE_CLIENT_SECRET)
SKIPPED [1] tests\test_sage_integration.py:57: Sage credentials not configured (set SAGE_CLIENT_ID and SAGE_CLIENT_SECRET)
SKIPPED [1] tests\test_sage_integration.py:95: Sage credentials not configured (set SAGE_CLIENT_ID and SAGE_CLIENT_SECRET)
SKIPPED [1] tests\test_sage_integration.py:112: Sage credentials not configured (set SAGE_CLIENT_ID and SAGE_CLIENT_SECRET)
SKIPPED [1] tests\test_sage_integration.py:130: Sage credentials not configured (set SAGE_CLIENT_ID and SAGE_CLIENT_SECRET)
SKIPPED [1] tests\test_sage_integration.py:151: Sage credentials not configured (set SAGE_CLIENT_ID and SAGE_CLIENT_SECRET)
SKIPPED [1] tests\test_sage_integration.py:206: Sage credentials not configured (set SAGE_CLIENT_ID and SAGE_CLIENT_SECRET)
SKIPPED [1] tests\test_sage_integration.py:226: Requires real Sage sandbox OAuth flow - manual test
SKIPPED [1] tests\test_storage_factory.py:48: boto3 not installed - S3 storage optional
SKIPPED [1] tests\test_storage_factory.py:116: boto3 not installed - S3 storage optional
SKIPPED [1] tests\test_subscription_error_paths.py:311: Stripe module imported inside function - mocking complex, error handling already verified in code
SKIPPED [1] tests\test_subscription_error_paths.py:335: Stripe module imported inside function - mocking complex, error handling already verified in code
SKIPPED [1] tests\test_subscription_error_paths.py:363: Stripe module imported inside function - mocking complex, event routing already verified in code
SKIPPED [1] tests\test_subscription_error_paths.py:406: Stripe module imported inside function - mocking complex, exception handling already verified in code
SKIPPED [1] tests\test_xero_integration.py:30: Xero credentials not configured (set XERO_CLIENT_ID and XERO_CLIENT_SECRET)
SKIPPED [1] tests\test_xero_integration.py:47: Xero credentials not configured (set XERO_CLIENT_ID and XERO_CLIENT_SECRET)
SKIPPED [1] tests\test_xero_integration.py:63: Xero credentials not configured (set XERO_CLIENT_ID and XERO_CLIENT_SECRET)
SKIPPED [1] tests\test_xero_integration.py:104: Requires real Xero sandbox OAuth flow - manual test
SKIPPED [1] tests\test_xero_integration.py:136: Xero credentials not configured (set XERO_CLIENT_ID and XERO_CLIENT_SECRET)
SKIPPED [1] tests\test_xero_integration.py:153: Xero credentials not configured (set XERO_CLIENT_ID and XERO_CLIENT_SECRET)
SKIPPED [1] tests\test_xero_integration.py:175: Xero credentials not configured (set XERO_CLIENT_ID and XERO_CLIENT_SECRET)
SKIPPED [1] tests\test_xero_integration.py:196: Xero credentials not configured (set XERO_CLIENT_ID and XERO_CLIENT_SECRET)
SKIPPED [1] tests\test_xero_integration.py:284: Xero credentials not configured (set XERO_CLIENT_ID and XERO_CLIENT_SECRET)
SKIPPED [1] tests\services\test_rbac_permissions.py:223: Auth dependency integration test - requires auth.py mocking
SKIPPED [1] tests\services\test_rbac_permissions.py:234: Auth dependency integration test - requires auth.py mocking
SKIPPED [1] tests\services\test_rbac_permissions.py:238: Auth dependency integration test - requires FastAPI request context
SKIPPED [1] tests\services\test_rbac_permissions.py:269: Entitlement service test - covered in test_entitlement.py
SKIPPED [1] tests\test_migrations\test_user_foreign_keys.py:150: SQLite doesn't enforce FK constraints by default - test requires PostgreSQL
SKIPPED [1] tests\test_migrations\test_user_foreign_keys.py:167: SQLite doesn't enforce FK constraints by default - test requires PostgreSQL
SKIPPED [1] tests\test_migrations\test_user_foreign_keys.py:189: SQLite doesn't enforce FK constraints by default - test requires PostgreSQL
========== 724 passed, 77 skipped, 360 warnings in 182.03s (0:03:02) ==========
===============================================================================
W0 path safety run - 2025-11-11T11:56:42Z - backend/venv/Scripts/python.exe -m pytest backend/tests/test_path_safety.py --maxfail=1 -vv
-------------------------------------------------------------------------------
============================= test session starts =============================
platform win32 -- Python 3.11.9, pytest-7.4.3, pluggy-1.6.0 -- C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver
configfile: pytest.ini
plugins: anyio-3.7.1, asyncio-0.21.1, cov-4.1.0
asyncio: mode=Mode.STRICT
collecting ... collected 3 items

backend/tests/test_path_safety.py::test_reserved_name_detection_handles_strings PASSED [ 33%]
backend/tests/test_path_safety.py::test_reserved_name_detection_handles_py_path_like_objects PASSED [ 66%]
backend/tests/test_path_safety.py::test_should_ignore_path_only_on_windows PASSED [100%]

============================== 3 passed in 0.38s ==============================
===============================================================================
============================= test session starts =============================
platform win32 -- Python 3.11.9, pytest-7.4.3, pluggy-1.6.0 -- C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver
configfile: pytest.ini
plugins: anyio-3.7.1, asyncio-0.21.1, cov-4.1.0
asyncio: mode=Mode.STRICT
collecting ... collected 3 items

backend/tests/test_path_safety.py::test_reserved_name_detection_handles_strings PASSED [ 33%]
backend/tests/test_path_safety.py::test_reserved_name_detection_handles_py_path_like_objects PASSED [ 66%]
backend/tests/test_path_safety.py::test_should_ignore_path_only_on_windows PASSED [100%]

============================== 3 passed in 0.27s ==============================
===============================================================================
W0 blog API run - 2025-11-11T11:59:10Z - backend/venv/Scripts/python.exe -m pytest backend/tests/api/test_blog.py --maxfail=1 -vv
-------------------------------------------------------------------------------
============================= test session starts =============================
platform win32 -- Python 3.11.9, pytest-7.4.3, pluggy-1.6.0 -- C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver
configfile: pytest.ini
plugins: anyio-3.7.1, asyncio-0.21.1, cov-4.1.0
asyncio: mode=Mode.STRICT
collecting ... collected 16 items

backend/tests/api/test_blog.py::test_list_blog_posts_default PASSED      [  6%]
backend/tests/api/test_blog.py::test_list_blog_posts_with_category_filter PASSED [ 12%]
backend/tests/api/test_blog.py::test_list_blog_posts_with_search PASSED  [ 18%]
backend/tests/api/test_blog.py::test_list_blog_posts_include_unpublished PASSED [ 25%]
backend/tests/api/test_blog.py::test_list_blog_posts_with_pagination PASSED [ 31%]
backend/tests/api/test_blog.py::test_list_blog_posts_empty_result PASSED [ 37%]
backend/tests/api/test_blog.py::test_get_blog_post_by_slug_success PASSED [ 43%]
backend/tests/api/test_blog.py::test_get_blog_post_by_slug_not_found PASSED [ 50%]
backend/tests/api/test_blog.py::test_get_unpublished_post_by_slug PASSED [ 56%]
backend/tests/api/test_blog.py::test_list_blog_categories PASSED         [ 62%]
backend/tests/api/test_blog.py::test_list_blog_categories_empty_database PASSED [ 68%]
backend/tests/api/test_blog.py::test_list_blog_posts_with_invalid_limit PASSED [ 75%]
backend/tests/api/test_blog.py::test_list_blog_posts_with_invalid_offset PASSED [ 81%]
backend/tests/api/test_blog.py::test_blog_post_response_schema PASSED    [ 87%]
backend/tests/api/test_blog.py::test_blog_search_case_insensitive PASSED [ 93%]
backend/tests/api/test_blog.py::test_blog_list_ordering PASSED           [100%]

============================== warnings summary ===============================
backend/tests/api/test_blog.py: 16 warnings
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\venv\Lib\site-packages\httpx\_client.py:680: DeprecationWarning: The 'app' shortcut is now deprecated. Use the explicit style 'transport=WSGITransport(app=...)' instead.
    warnings.warn(message, DeprecationWarning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
======================= 16 passed, 16 warnings in 1.95s =======================
===============================================================================
============================= test session starts =============================
platform win32 -- Python 3.11.9, pytest-7.4.3, pluggy-1.6.0 -- C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver
configfile: pytest.ini
plugins: anyio-3.7.1, asyncio-0.21.1, cov-4.1.0
asyncio: mode=Mode.STRICT
collecting ... collected 4 items

backend/tests/test_path_safety.py::test_pytest_ignore_collect_delegates_to_path_safety PASSED [ 25%]
backend/tests/test_path_safety.py::test_reserved_name_detection_handles_strings PASSED [ 50%]
backend/tests/test_path_safety.py::test_reserved_name_detection_handles_py_path_like_objects PASSED [ 75%]
backend/tests/test_path_safety.py::test_should_ignore_path_only_on_windows PASSED [100%]

============================== 4 passed in 0.38s ==============================
============================= test session starts =============================
platform win32 -- Python 3.11.9, pytest-7.4.3, pluggy-1.6.0 -- C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver
configfile: pytest.ini
plugins: anyio-3.7.1, asyncio-0.21.1, cov-4.1.0
asyncio: mode=Mode.STRICT
collecting ... collected 34 items

backend/tests/test_billing_endpoints.py::test_create_checkout_session_success PASSED [  2%]
backend/tests/test_billing_endpoints.py::test_create_checkout_session_invalid_tier PASSED [  5%]
backend/tests/test_billing_endpoints.py::test_create_checkout_session_requires_auth PASSED [  8%]
backend/tests/test_billing_endpoints.py::test_create_checkout_session_existing_subscription PASSED [ 11%]
backend/tests/test_billing_endpoints.py::test_create_checkout_session_with_trial PASSED [ 14%]
backend/tests/test_billing_endpoints.py::test_get_subscription_success PASSED [ 17%]
backend/tests/test_billing_endpoints.py::test_get_subscription_not_found PASSED [ 20%]
backend/tests/test_billing_endpoints.py::test_get_subscription_requires_auth PASSED [ 23%]
backend/tests/test_billing_endpoints.py::test_update_subscription_tier_upgrade PASSED [ 26%]
backend/tests/test_billing_endpoints.py::test_update_subscription_tier_downgrade PASSED [ 29%]
backend/tests/test_billing_endpoints.py::test_cancel_subscription_at_period_end PASSED [ 32%]
backend/tests/test_billing_endpoints.py::test_cancel_subscription_immediately PASSED [ 35%]
backend/tests/test_billing_endpoints.py::test_cancel_subscription_requires_active_subscription PASSED [ 38%]
backend/tests/test_billing_endpoints.py::test_customer_portal_redirect PASSED [ 41%]
backend/tests/test_subscription_error_paths.py::test_create_checkout_session_value_error PASSED [ 44%]
backend/tests/test_subscription_error_paths.py::test_create_checkout_session_general_exception PASSED [ 47%]
backend/tests/test_subscription_error_paths.py::test_get_my_subscription_not_found PASSED [ 50%]
backend/tests/test_subscription_error_paths.py::test_billing_dashboard_no_subscription PASSED [ 52%]
backend/tests/test_subscription_error_paths.py::test_billing_dashboard_with_subscription PASSED [ 55%]
backend/tests/test_subscription_error_paths.py::test_billing_dashboard_zero_counts PASSED [ 58%]
backend/tests/test_subscription_error_paths.py::test_change_tier_value_error PASSED [ 61%]
backend/tests/test_subscription_error_paths.py::test_change_tier_general_exception PASSED [ 64%]
backend/tests/test_subscription_error_paths.py::test_cancel_subscription_value_error PASSED [ 67%]
backend/tests/test_subscription_error_paths.py::test_cancel_subscription_general_exception PASSED [ 70%]
backend/tests/test_subscription_error_paths.py::test_get_all_tiers_success PASSED [ 73%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_missing_secret PASSED [ 76%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_invalid_payload SKIPPEDng already verified in code) [ 79%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_invalid_signature SKIPPEDng already verified in code) [ 82%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_successful_events SKIPPEDg already verified in code) [ 85%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_handler_exception_caught SKIPPEDndling already verified in code) [ 88%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_routes_events[checkout.session.completed-handle_checkout_completed] PASSED [ 91%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_routes_events[invoice.paid-handle_invoice_paid] PASSED [ 94%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_routes_events[customer.subscription.updated-handle_subscription_updated] PASSED [ 97%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_routes_events[customer.subscription.deleted-handle_subscription_deleted] PASSED [100%]

============================== warnings summary ===============================
backend\venv\Lib\site-packages\coverage\core.py:93
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\venv\Lib\site-packages\coverage\core.py:93: CoverageWarning: Couldn't import C tracer: No module named 'coverage.tracer' (no-ctracer); see https://coverage.readthedocs.io/en/7.11.0/messages.html#warning-no-ctracer
    warn(f"Couldn't import C tracer: {IMPORT_ERROR}", slug="no-ctracer", once=True)

backend/tests/test_billing_endpoints.py: 14 warnings
backend/tests/test_subscription_error_paths.py: 16 warnings
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\venv\Lib\site-packages\httpx\_client.py:680: DeprecationWarning: The 'app' shortcut is now deprecated. Use the explicit style 'transport=WSGITransport(app=...)' instead.
    warnings.warn(message, DeprecationWarning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform win32, python 3.11.9-final-0 -----------
Name                                                  Stmts   Miss  Cover
-------------------------------------------------------------------------
backend\app\__init__.py                                   1      0   100%
backend\app\api\__init__.py                              21      0   100%
backend\app\api\dependencies\__init__.py                  0      0   100%
backend\app\api\dependencies\auth.py                    101     73    28%
backend\app\api\dependencies\rbac.py                      2      2     0%
backend\app\api\document_sharing.py                     121     92    24%
backend\app\api\routes\__init__.py                        2      0   100%
backend\app\api\routes\auth.py                            9      1    89%
backend\app\api\routes\blog.py                           55     23    58%
backend\app\api\routes\dashboard.py                      25      7    72%
backend\app\api\routes\deal_matching.py                  77     50    35%
backend\app\api\routes\deals.py                          64     39    39%
backend\app\api\routes\documents.py                     174    110    37%
backend\app\api\routes\financial.py                     151    109    28%
backend\app\api\routes\marketing.py                      69     36    48%
backend\app\api\routes\master_admin.py                  379    241    36%
backend\app\api\routes\pipeline_templates.py             34     14    59%
backend\app\api\routes\podcasts.py                      306    255    17%
backend\app\api\routes\subscriptions.py                  99      6    94%
backend\app\api\routes\tasks.py                          69     39    43%
backend\app\api\routes\valuation.py                     145     90    38%
backend\app\api\webhooks\__init__.py                      0      0   100%
backend\app\api\webhooks\clerk.py                        52     39    25%
backend\app\core\__init__.py                              0      0   100%
backend\app\core\config.py                               44      0   100%
backend\app\core\database.py                             30     17    43%
backend\app\core\security.py                             23     12    48%
backend\app\core\subscription.py                         52     33    37%
backend\app\db\__init__.py                                0      0   100%
backend\app\db\base.py                                    3      0   100%
backend\app\db\session.py                                 3      0   100%
backend\app\db\types.py                                  11      1    91%
backend\app\main.py                                      27      3    89%
backend\app\models\__init__.py                           20      0   100%
backend\app\models\blog_post.py                          23      0   100%
backend\app\models\contact_message.py                    14      0   100%
backend\app\models\deal.py                               56      0   100%
backend\app\models\deal_match.py                         65      9    86%
backend\app\models\document.py                           97      0   100%
backend\app\models\enums.py                              65      0   100%
backend\app\models\financial_connection.py               25      0   100%
backend\app\models\financial_narrative.py                34      0   100%
backend\app\models\financial_ratio.py                    67      0   100%
backend\app\models\financial_statement.py                78      0   100%
backend\app\models\master_admin.py                      242      0   100%
backend\app\models\newsletter_subscription.py            10      0   100%
backend\app\models\organization.py                       18      0   100%
backend\app\models\pipeline_template.py                  30      0   100%
backend\app\models\podcast.py                            49      0   100%
backend\app\models\podcast_usage.py                      13      0   100%
backend\app\models\rbac_audit_log.py                     25      0   100%
backend\app\models\subscription.py                       54      0   100%
backend\app\models\task.py                               68      0   100%
backend\app\models\user.py                               43      2    95%
backend\app\models\valuation.py                         120      0   100%
backend\app\schemas\__init__.py                           3      0   100%
backend\app\schemas\deal.py                              40      0   100%
backend\app\schemas\deal_match.py                        68      0   100%
backend\app\schemas\document.py                         183     17    91%
backend\app\schemas\financial.py                         79      0   100%
backend\app\schemas\master_admin.py                     420      0   100%
backend\app\schemas\pipeline_template.py                 53     14    74%
backend\app\schemas\podcast.py                           52      0   100%
backend\app\schemas\subscription.py                      89      0   100%
backend\app\schemas\task.py                              88      0   100%
backend\app\schemas\user.py                              33      1    97%
backend\app\schemas\valuation.py                        258     10    96%
backend\app\services\__init__.py                          6      0   100%
backend\app\services\audio_chunking_service.py          102    102     0%
backend\app\services\deal_matching_service.py           161    126    22%
backend\app\services\deal_service.py                     81     66    19%
backend\app\services\document_service.py                514    459    11%
backend\app\services\entitlement_service.py              47     31    34%
backend\app\services\financial_narrative_service.py     231    231     0%
backend\app\services\financial_ratios.py                240    190    21%
backend\app\services\invite_service.py                   31     31     0%
backend\app\services\master_admin_service.py            435    363    17%
backend\app\services\organization_service.py             64     50    22%
backend\app\services\pipeline_template_service.py        39     27    31%
backend\app\services\podcast_service.py                 115     92    20%
backend\app\services\quota_service.py                   165    132    20%
backend\app\services\rbac_audit_service.py               20     11    45%
backend\app\services\storage_service.py                  71     46    35%
backend\app\services\subscription_service.py            134     55    59%
backend\app\services\task_service.py                     35     23    34%
backend\app\services\task_template_service.py            61     43    30%
backend\app\services\thumbnail_service.py                93     93     0%
backend\app\services\user_service.py                     75     60    20%
backend\app\services\valuation_service.py               334    282    16%
backend\app\services\youtube_service.py                  57     34    40%
backend\app\tasks\__init__.py                             2      0   100%
backend\app\tasks\task_automation.py                     25     16    36%
backend\app\utils\__init__.py                             0      0   100%
backend\app\utils\datetime.py                             4      1    75%
-------------------------------------------------------------------------
TOTAL                                                  7873   3909    50%

=========================== short test summary info ===========================
SKIPPED [1] backend\tests\test_subscription_error_paths.py:311: Stripe module imported inside function - mocking complex, error handling already verified in code
SKIPPED [1] backend\tests\test_subscription_error_paths.py:335: Stripe module imported inside function - mocking complex, error handling already verified in code
SKIPPED [1] backend\tests\test_subscription_error_paths.py:363: Stripe module imported inside function - mocking complex, event routing already verified in code
SKIPPED [1] backend\tests\test_subscription_error_paths.py:406: Stripe module imported inside function - mocking complex, exception handling already verified in code
================= 30 passed, 4 skipped, 31 warnings in 14.91s =================
===============================================================================
W1 billing/subscription run - 2025-11-11T12:08:12Z - backend/venv/Scripts/python.exe -m pytest backend/tests/test_billing_endpoints.py backend/tests/test_subscription_error_paths.py --maxfail=1 --cov=backend/app -vv
-------------------------------------------------------------------------------
============================= test session starts =============================
platform win32 -- Python 3.11.9, pytest-7.4.3, pluggy-1.6.0 -- C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver
configfile: pytest.ini
plugins: anyio-3.7.1, asyncio-0.21.1, cov-4.1.0
asyncio: mode=Mode.STRICT
collecting ... collected 34 items

backend/tests/test_billing_endpoints.py::test_create_checkout_session_success PASSED [  2%]
backend/tests/test_billing_endpoints.py::test_create_checkout_session_invalid_tier PASSED [  5%]
backend/tests/test_billing_endpoints.py::test_create_checkout_session_requires_auth PASSED [  8%]
backend/tests/test_billing_endpoints.py::test_create_checkout_session_existing_subscription PASSED [ 11%]
backend/tests/test_billing_endpoints.py::test_create_checkout_session_with_trial PASSED [ 14%]
backend/tests/test_billing_endpoints.py::test_get_subscription_success PASSED [ 17%]
backend/tests/test_billing_endpoints.py::test_get_subscription_not_found PASSED [ 20%]
backend/tests/test_billing_endpoints.py::test_get_subscription_requires_auth PASSED [ 23%]
backend/tests/test_billing_endpoints.py::test_update_subscription_tier_upgrade PASSED [ 26%]
backend/tests/test_billing_endpoints.py::test_update_subscription_tier_downgrade PASSED [ 29%]
backend/tests/test_billing_endpoints.py::test_cancel_subscription_at_period_end PASSED [ 32%]
backend/tests/test_billing_endpoints.py::test_cancel_subscription_immediately PASSED [ 35%]
backend/tests/test_billing_endpoints.py::test_cancel_subscription_requires_active_subscription PASSED [ 38%]
backend/tests/test_billing_endpoints.py::test_customer_portal_redirect PASSED [ 41%]
backend/tests/test_subscription_error_paths.py::test_create_checkout_session_value_error PASSED [ 44%]
backend/tests/test_subscription_error_paths.py::test_create_checkout_session_general_exception PASSED [ 47%]
backend/tests/test_subscription_error_paths.py::test_get_my_subscription_not_found PASSED [ 50%]
backend/tests/test_subscription_error_paths.py::test_billing_dashboard_no_subscription PASSED [ 52%]
backend/tests/test_subscription_error_paths.py::test_billing_dashboard_with_subscription PASSED [ 55%]
backend/tests/test_subscription_error_paths.py::test_billing_dashboard_zero_counts PASSED [ 58%]
backend/tests/test_subscription_error_paths.py::test_change_tier_value_error PASSED [ 61%]
backend/tests/test_subscription_error_paths.py::test_change_tier_general_exception PASSED [ 64%]
backend/tests/test_subscription_error_paths.py::test_cancel_subscription_value_error PASSED [ 67%]
backend/tests/test_subscription_error_paths.py::test_cancel_subscription_general_exception PASSED [ 70%]
backend/tests/test_subscription_error_paths.py::test_get_all_tiers_success PASSED [ 73%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_missing_secret PASSED [ 76%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_invalid_payload SKIPPEDng already verified in code) [ 79%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_invalid_signature SKIPPEDng already verified in code) [ 82%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_successful_events SKIPPEDg already verified in code) [ 85%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_handler_exception_caught SKIPPEDndling already verified in code) [ 88%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_routes_events[checkout.session.completed-handle_checkout_completed] PASSED [ 91%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_routes_events[invoice.paid-handle_invoice_paid] PASSED [ 94%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_routes_events[customer.subscription.updated-handle_subscription_updated] PASSED [ 97%]
backend/tests/test_subscription_error_paths.py::test_stripe_webhook_routes_events[customer.subscription.deleted-handle_subscription_deleted] PASSED [100%]

============================== warnings summary ===============================
backend\venv\Lib\site-packages\coverage\core.py:93
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\venv\Lib\site-packages\coverage\core.py:93: CoverageWarning: Couldn't import C tracer: No module named 'coverage.tracer' (no-ctracer); see https://coverage.readthedocs.io/en/7.11.0/messages.html#warning-no-ctracer
    warn(f"Couldn't import C tracer: {IMPORT_ERROR}", slug="no-ctracer", once=True)

backend/tests/test_billing_endpoints.py: 14 warnings
backend/tests/test_subscription_error_paths.py: 16 warnings
  C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver\backend\venv\Lib\site-packages\httpx\_client.py:680: DeprecationWarning: The 'app' shortcut is now deprecated. Use the explicit style 'transport=WSGITransport(app=...)' instead.
    warnings.warn(message, DeprecationWarning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform win32, python 3.11.9-final-0 -----------
Name                                                  Stmts   Miss  Cover
-------------------------------------------------------------------------
backend\app\__init__.py                                   1      0   100%
backend\app\api\__init__.py                              21      0   100%
backend\app\api\dependencies\__init__.py                  0      0   100%
backend\app\api\dependencies\auth.py                    101     73    28%
backend\app\api\dependencies\rbac.py                      2      2     0%
backend\app\api\document_sharing.py                     121     92    24%
backend\app\api\routes\__init__.py                        2      0   100%
backend\app\api\routes\auth.py                            9      1    89%
backend\app\api\routes\blog.py                           55     23    58%
backend\app\api\routes\dashboard.py                      25      7    72%
backend\app\api\routes\deal_matching.py                  77     50    35%
backend\app\api\routes\deals.py                          64     39    39%
backend\app\api\routes\documents.py                     174    110    37%
backend\app\api\routes\financial.py                     151    109    28%
backend\app\api\routes\marketing.py                      69     36    48%
backend\app\api\routes\master_admin.py                  379    241    36%
backend\app\api\routes\pipeline_templates.py             34     14    59%
backend\app\api\routes\podcasts.py                      306    255    17%
backend\app\api\routes\subscriptions.py                  99      6    94%
backend\app\api\routes\tasks.py                          69     39    43%
backend\app\api\routes\valuation.py                     145     90    38%
backend\app\api\webhooks\__init__.py                      0      0   100%
backend\app\api\webhooks\clerk.py                        52     39    25%
backend\app\core\__init__.py                              0      0   100%
backend\app\core\config.py                               44      0   100%
backend\app\core\database.py                             30     17    43%
backend\app\core\security.py                             23     12    48%
backend\app\core\subscription.py                         52     33    37%
backend\app\db\__init__.py                                0      0   100%
backend\app\db\base.py                                    3      0   100%
backend\app\db\session.py                                 3      0   100%
backend\app\db\types.py                                  11      1    91%
backend\app\main.py                                      27      3    89%
backend\app\models\__init__.py                           20      0   100%
backend\app\models\blog_post.py                          23      0   100%
backend\app\models\contact_message.py                    14      0   100%
backend\app\models\deal.py                               56      0   100%
backend\app\models\deal_match.py                         65      9    86%
backend\app\models\document.py                           97      0   100%
backend\app\models\enums.py                              65      0   100%
backend\app\models\financial_connection.py               25      0   100%
backend\app\models\financial_narrative.py                34      0   100%
backend\app\models\financial_ratio.py                    67      0   100%
backend\app\models\financial_statement.py                78      0   100%
backend\app\models\master_admin.py                      242      0   100%
backend\app\models\newsletter_subscription.py            10      0   100%
backend\app\models\organization.py                       18      0   100%
backend\app\models\pipeline_template.py                  30      0   100%
backend\app\models\podcast.py                            49      0   100%
backend\app\models\podcast_usage.py                      13      0   100%
backend\app\models\rbac_audit_log.py                     25      0   100%
backend\app\models\subscription.py                       54      0   100%
backend\app\models\task.py                               68      0   100%
backend\app\models\user.py                               43      2    95%
backend\app\models\valuation.py                         120      0   100%
backend\app\schemas\__init__.py                           3      0   100%
backend\app\schemas\deal.py                              40      0   100%
backend\app\schemas\deal_match.py                        68      0   100%
backend\app\schemas\document.py                         183     17    91%
backend\app\schemas\financial.py                         79      0   100%
backend\app\schemas\master_admin.py                     420      0   100%
backend\app\schemas\pipeline_template.py                 53     14    74%
backend\app\schemas\podcast.py                           52      0   100%
backend\app\schemas\subscription.py                      89      0   100%
backend\app\schemas\task.py                              88      0   100%
backend\app\schemas\user.py                              33      1    97%
backend\app\schemas\valuation.py                        258     10    96%
backend\app\services\__init__.py                          6      0   100%
backend\app\services\audio_chunking_service.py          102    102     0%
backend\app\services\deal_matching_service.py           161    126    22%
backend\app\services\deal_service.py                     81     66    19%
backend\app\services\document_service.py                514    459    11%
backend\app\services\entitlement_service.py              47     31    34%
backend\app\services\financial_narrative_service.py     231    231     0%
backend\app\services\financial_ratios.py                240    190    21%
backend\app\services\invite_service.py                   31     31     0%
backend\app\services\master_admin_service.py            435    363    17%
backend\app\services\organization_service.py             64     50    22%
backend\app\services\pipeline_template_service.py        39     27    31%
backend\app\services\podcast_service.py                 115     92    20%
backend\app\services\quota_service.py                   165    132    20%
backend\app\services\rbac_audit_service.py               20     11    45%
backend\app\services\storage_service.py                  71     46    35%
backend\app\services\subscription_service.py            134     55    59%
backend\app\services\task_service.py                     35     23    34%
backend\app\services\task_template_service.py            61     43    30%
backend\app\services\thumbnail_service.py                93     93     0%
backend\app\services\user_service.py                     75     60    20%
backend\app\services\valuation_service.py               334    282    16%
backend\app\services\youtube_service.py                  57     34    40%
backend\app\tasks\__init__.py                             2      0   100%
backend\app\tasks\task_automation.py                     25     16    36%
backend\app\utils\__init__.py                             0      0   100%
backend\app\utils\datetime.py                             4      1    75%
-------------------------------------------------------------------------
TOTAL                                                  7873   3909    50%

=========================== short test summary info ===========================
SKIPPED [1] backend\tests\test_subscription_error_paths.py:311: Stripe module imported inside function - mocking complex, error handling already verified in code
SKIPPED [1] backend\tests\test_subscription_error_paths.py:335: Stripe module imported inside function - mocking complex, error handling already verified in code
SKIPPED [1] backend\tests\test_subscription_error_paths.py:363: Stripe module imported inside function - mocking complex, event routing already verified in code
SKIPPED [1] backend\tests\test_subscription_error_paths.py:406: Stripe module imported inside function - mocking complex, exception handling already verified in code
================= 30 passed, 4 skipped, 31 warnings in 18.54s =================
===============================================================================
