============================= test session starts =============================
platform win32 -- Python 3.11.9, pytest-7.4.3, pluggy-1.6.0
rootdir: C:\Projects\ma-saas-platform\M-S-SaaS-apex-deliver
configfile: pytest.ini
plugins: anyio-3.7.1, asyncio-0.21.1, cov-4.1.0
asyncio: mode=Mode.STRICT
collected 1785 items

tests\test_additional_ratios.py ...............                          [  0%]
tests\test_api_middleware.py ...............                             [  1%]
tests\test_audio_chunking_service.py .................                   [  2%]
tests\test_auth_dependencies_edge_cases.py ...............               [  3%]
tests\test_auth_helpers.py .....................                         [  4%]
tests\test_billing_endpoints.py ..................                       [  5%]
tests\test_billing_simple.py ...                                         [  5%]
tests\test_blog_api_errors.py .......                                    [  6%]
tests\test_caching.py ...............                                    [  7%]
tests\test_campaign_schema_migration.py ......................s          [  8%]
tests\test_campaign_service.py .........                                 [  8%]
tests\test_clerk_auth_complete.py ..........................             [ 10%]
tests\test_community_api.py ........................                     [ 11%]
tests\test_community_models.py .............                             [ 12%]
tests\test_community_service.py .............................            [ 14%]
tests\test_core_edge_cases.py ...s...................                    [ 15%]
tests\test_dashboard_api.py ......                                       [ 15%]
tests\test_database_infrastructure.py ............                       [ 16%]
tests\test_database_reset.py ..                                          [ 16%]
tests\test_deal_endpoints.py .........................                   [ 17%]
tests\test_deal_matching_api.py ..................                       [ 18%]
tests\test_deal_matching_models.py ........                              [ 19%]
tests\test_deal_matching_service.py ...............                      [ 20%]
tests\test_document_ai_and_versions.py .....                             [ 20%]
tests\test_document_endpoints.py ....................................... [ 22%]
.....                                                                    [ 22%]
tests\test_document_export_jobs_api.py ....                              [ 23%]
tests\test_document_generation_api.py ....................               [ 24%]
tests\test_document_generation_api_errors.py ............                [ 24%]
tests\test_document_generation_models.py ..........                      [ 25%]
tests\test_document_service.py ....                                      [ 25%]
tests\test_document_service_error_paths.py ..F

================================== FAILURES ===================================
________ test_resolve_document_permission_inherits_folder_permissions _________

db_session = <sqlalchemy.orm.session.Session object at 0x00000201DB4FF910>
create_deal_for_org = <function create_deal_for_org.<locals>._create at 0x00000201DB7CF380>

    
    def test_resolve_document_permission_inherits_folder_permissions(
        db_session: Session,
        create_deal_for_org,
    ):
        """
        TDD RED: _resolve_document_permission should inherit folder-level permissions.
        """
    
        deal, owner, organization = create_deal_for_org()
        collaborator = User(
            id=str(uuid.uuid4()),
            clerk_user_id="clerk-collab",
            email="collab@example.com",
            organization_id=organization.id,
            role=UserRole.growth,
        )
        db_session.add(collaborator)
        db_session.commit()
    
        folder, document = _create_base_document(
            db_session,
            deal=deal,
            owner=owner,
            organization=organization,
        )
    
        permission = DocumentPermission(
            id=str(uuid.uuid4()),
            folder_id=str(folder.id),
            document_id=None,
>           user_id=str(collaborator.id),
            permission_level=PermissionLevel.EDITOR,
            organization_id=organization.id,
            granted_by=owner.id,
        )
E       NameError: name 'PermissionLevel' is not defined

tests\test_document_service_error_paths.py:212: NameError
=========================== short test summary info ===========================
SKIPPED [1] tests\test_campaign_schema_migration.py:212: Enum introspection only supported on PostgreSQL in tests
SKIPPED [1] tests\test_core_edge_cases.py:58: Database module uses lazy initialization; connection errors are handled at connection-time by SQLAlchemy engine, not in get_db()
FAILED tests\test_document_service_error_paths.py::test_resolve_document_permission_inherits_folder_permissions
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!
===== 1 failed, 458 passed, 2 skipped, 284 warnings in 141.82s (0:02:21) ======
