# v1.1.0 Planning Document

**Date**: 2025-11-15
**Status**: ðŸŸ¡ PLANNING
**Methodology**: BMAD v6-alpha + TDD
**Previous Release**: v1.0.0 (Production Release)

---

## Overview

v1.1.0 focuses on enhancing the Event Management Hub and Community Platform with payment processing, notifications, and improved user experience features.

---

## Planned Features

### 1. Stripe Event Payments âœ…
**Priority**: P0 (High)
**Epic**: Event Management Hub Enhancement
**Estimated Effort**: 5-7 days (TDD)
**Status**: âœ… **GREEN PHASE COMPLETE** (2025-11-15)

**Description**:
- Integrate Stripe payment processing for event ticket purchases
- Support multiple ticket types with different pricing
- Handle payment webhooks for ticket purchases
- Generate receipts and confirmation emails

**Acceptance Criteria**:
- [x] Users can purchase event tickets via Stripe Checkout âœ…
- [x] Multiple ticket types supported (VIP, Standard, Early Bird) âœ…
- [x] Payment webhooks processed correctly âœ…
- [x] Receipts generated and stored âœ…
- [x] Backend code implemented (~1,210 lines) âœ…
- [ ] Backend coverage â‰¥90% for payment flows (pending test execution)
- [ ] Frontend coverage â‰¥85% for payment UI (pending frontend implementation)

**TDD Approach**:
1. **RED**: Write tests for payment processing, webhook handling, receipt generation
2. **GREEN**: Implement Stripe integration, webhook handlers, receipt service
3. **REFACTOR**: Extract payment utilities, improve error handling

**Files to Create/Modify**:
- `backend/app/services/event_payment_service.py` (NEW)
- `backend/app/api/routes/event_payments.py` (NEW)
- `backend/app/models/event_payment.py` (NEW)
- `backend/tests/test_event_payment_service.py` (NEW)
- `backend/tests/test_event_payment_api.py` (NEW)
- `frontend/src/services/api/eventPayments.ts` (NEW)
- `frontend/src/components/events/TicketPurchaseModal.tsx` (NEW)
- `frontend/src/pages/events/EventCheckout.test.tsx` (NEW)

---

### 2. Email Notifications
**Priority**: P0 (High)
**Epic**: Platform Communication
**Estimated Effort**: 4-6 days (TDD)

**Description**:
- Email notification system for events, community interactions, and system updates
- Support for transactional emails (ticket confirmations, event reminders)
- Support for notification preferences per user
- Email templates with branding

**Acceptance Criteria**:
- [ ] Email service integrated (SendGrid/Resend)
- [ ] Event ticket confirmation emails sent
- [ ] Event reminder emails sent (24h, 1h before)
- [ ] Community notification emails (new comments, reactions)
- [ ] User notification preferences respected
- [ ] Email templates with branding
- [ ] Backend coverage â‰¥90% for email service
- [ ] Frontend coverage â‰¥85% for notification preferences UI

**TDD Approach**:
1. **RED**: Write tests for email sending, template rendering, notification preferences
2. **GREEN**: Implement email service, templates, notification preferences
3. **REFACTOR**: Extract email utilities, improve template management

**Files to Create/Modify**:
- `backend/app/services/email_service.py` (NEW)
- `backend/app/services/notification_service.py` (NEW)
- `backend/app/models/user_notification_preferences.py` (NEW)
- `backend/app/templates/emails/` (NEW - email templates)
- `backend/tests/test_email_service.py` (NEW)
- `backend/tests/test_notification_service.py` (NEW)
- `frontend/src/components/notifications/NotificationPreferences.tsx` (NEW)
- `frontend/src/pages/settings/NotificationSettings.test.tsx` (NEW)

---

### 3. EventCreator Test Fixes
**Priority**: P1 (Medium)
**Epic**: Event Management Hub Quality
**Estimated Effort**: 2-3 days (TDD)

**Description**:
- Fix failing or flaky tests in EventCreator components
- Improve test coverage for event creation flows
- Ensure deterministic test behavior

**Acceptance Criteria**:
- [ ] All EventCreator tests passing consistently
- [ ] Test coverage â‰¥85% for EventCreator components
- [ ] No flaky tests
- [ ] All edge cases covered

**TDD Approach**:
1. **RED**: Identify failing/flaky tests, write missing test cases
2. **GREEN**: Fix test issues, improve test setup, add missing coverage
3. **REFACTOR**: Improve test organization, extract shared test utilities

**Files to Modify**:
- `frontend/src/components/events/EventCreator.test.tsx` (FIX)
- `frontend/src/components/events/EventCreator.tsx` (if needed)
- `frontend/src/tests/fixtures/events.ts` (if needed)

---

### 4. QR Code Check-in
**Priority**: P1 (Medium)
**Epic**: Event Management Hub Enhancement
**Estimated Effort**: 3-5 days (TDD)

**Description**:
- Generate QR codes for event tickets
- Mobile check-in system using QR code scanning
- Check-in status tracking and analytics
- Support for multiple check-in points

**Acceptance Criteria**:
- [ ] QR codes generated for each ticket
- [ ] Mobile check-in interface for event organizers
- [ ] QR code scanning functionality
- [ ] Check-in status tracked and displayed
- [ ] Check-in analytics dashboard
- [ ] Backend coverage â‰¥90% for check-in service
- [ ] Frontend coverage â‰¥85% for check-in UI

**TDD Approach**:
1. **RED**: Write tests for QR code generation, scanning, check-in processing
2. **GREEN**: Implement QR code service, check-in API, mobile UI
3. **REFACTOR**: Extract QR code utilities, improve check-in flow

**Files to Create/Modify**:
- `backend/app/services/qr_code_service.py` (NEW)
- `backend/app/api/routes/event_checkin.py` (NEW)
- `backend/app/models/event_checkin.py` (NEW)
- `backend/tests/test_qr_code_service.py` (NEW)
- `backend/tests/test_event_checkin_api.py` (NEW)
- `frontend/src/components/events/QRCodeScanner.tsx` (NEW)
- `frontend/src/components/events/CheckInInterface.tsx` (NEW)
- `frontend/src/pages/events/EventCheckIn.test.tsx` (NEW)

---

## Implementation Plan

### Sprint 1: Foundation (Week 1)
- **Day 1-2**: Stripe Event Payments (RED phase)
- **Day 3-4**: Email Notifications (RED phase)
- **Day 5**: EventCreator Test Fixes (RED phase)

### Sprint 2: Core Features (Week 2)
- **Day 1-3**: Stripe Event Payments (GREEN phase)
- **Day 4-5**: Email Notifications (GREEN phase)
- **Day 6-7**: EventCreator Test Fixes (GREEN + REFACTOR)

### Sprint 3: Enhancement (Week 3)
- **Day 1-2**: QR Code Check-in (RED phase)
- **Day 3-5**: QR Code Check-in (GREEN phase)
- **Day 6-7**: All features (REFACTOR + Documentation)

---

## Testing Strategy

### Backend Testing
- **Target Coverage**: â‰¥90%
- **Focus Areas**: Payment processing, email sending, QR code generation, check-in processing
- **Tools**: pytest, pytest-cov, pytest-asyncio

### Frontend Testing
- **Target Coverage**: â‰¥85%
- **Focus Areas**: Payment UI, notification preferences, QR code scanning, check-in interface
- **Tools**: Vitest, React Testing Library, MSW

### Integration Testing
- Payment webhook handling
- Email delivery verification
- QR code scanning end-to-end
- Check-in flow end-to-end

---

## Dependencies

### External Services
- **Stripe**: Payment processing (already integrated for subscriptions)
- **SendGrid/Resend**: Email delivery (NEW)
- **QR Code Library**: QR code generation (NEW - `qrcode` Python library, `qrcode.react` for frontend)

### Internal Dependencies
- Event Management Hub (F-012) - existing
- Community Platform (F-013) - existing
- Subscription & Billing (F-005) - existing Stripe integration

---

## Success Criteria

### Functional
- [ ] Users can purchase event tickets via Stripe
- [ ] Email notifications sent for events and community interactions
- [ ] All EventCreator tests passing
- [ ] QR code check-in working for event organizers

### Quality
- [ ] Backend coverage â‰¥90%
- [ ] Frontend coverage â‰¥85%
- [ ] All tests passing (no flaky tests)
- [ ] No critical bugs

### Documentation
- [ ] Story files updated with acceptance evidence
- [ ] API documentation updated
- [ ] User guides updated (if needed)
- [ ] Release notes prepared

---

## Risk Assessment

### High Risk
- **Stripe Payment Integration**: Complex webhook handling, need thorough testing
- **Email Delivery**: Reliability and deliverability concerns

### Medium Risk
- **QR Code Check-in**: Mobile device compatibility, camera permissions
- **EventCreator Test Fixes**: May uncover deeper issues

### Mitigation
- Use Stripe test mode extensively
- Implement email retry logic and error handling
- Test QR code scanning on multiple devices
- Allocate buffer time for test fixes

---

## Timeline

**Start Date**: 2025-11-15
**Target Completion**: 2025-12-06 (3 weeks)
**Buffer**: +3 days for unexpected issues

---

## Next Steps

1. **Create Story Files**:
   - `docs/bmad/stories/DEV-019-stripe-event-payments.md`
   - `docs/bmad/stories/DEV-020-email-notifications.md`
   - `docs/bmad/stories/DEV-021-event-creator-test-fixes.md`
   - `docs/bmad/stories/DEV-022-qr-code-checkin.md`

2. **Set Up Development Environment**:
   - Configure Stripe test keys
   - Set up email service (SendGrid/Resend)
   - Install QR code libraries

3. **Begin Sprint 1**:
   - Start with Stripe Event Payments (RED phase)
   - Follow TDD methodology strictly

---

## Notes

- All features must follow BMAD v6-alpha methodology
- Strict TDD (RED â†’ GREEN â†’ REFACTOR) for all work
- Maintain â‰¥90% backend and â‰¥85% frontend coverage
- Update BMAD trackers and workflow status after each story completion

---

**Status**: ðŸŸ¡ PLANNING
**Next Action**: Create story files and begin Sprint 1
**Owner**: Development Team

