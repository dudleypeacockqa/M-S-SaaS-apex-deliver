# V1.2 Gap Analysis & Story Mapping

**Date:** 2025-11-18  
**Owner:** Codex (Architect)  
**Sources:** `docs/PRD.md`, `docs/architecture.md`, repository code, TODO scans (`grep TODO backend`, `grep TODO frontend`)

---

## 1. Summary

| Area | Existing Coverage | Gaps Identified | Story IDs |
| --- | --- | --- | --- |
| Backend Forecasting & Planning | `backend/app/api/routes/fpa.py` stubs, services missing | Demand forecasting, scenario creation, report generation not implemented | `DEV-022` |
| Backend Document Generation | `backend/app/api/routes/document_generation.py`, `app/services/document_generation_service.py` | Missing user attribution + file generation tasks | `DEV-023` |
| Backend Automation & Caching | `backend/app/tasks/campaign_tasks.py`, `backend/tests/test_caching.py` | Email delivery stubbed; caching tests incomplete | `DEV-024` |
| Frontend Document Workspace & Bulk Actions | `frontend/src/pages/documents/DocumentWorkspace.tsx`, `frontend/src/hooks/useBulkActions.ts` | Permission updates, audit logs, confirmation flows, API calls missing | `FRN-030` |
| Frontend Valuation & Dashboard UX | `frontend/src/pages/deals/valuation/ValuationSuite.test.tsx`, `frontend/src/pages/DashboardPage.tsx` | Skipped tests, missing upgrade handling, placeholder task API | `FRN-031` |
| Frontend Marketing & Master Admin UI | `frontend/src/pages/marketing/PodcastPage.tsx`, `frontend/src/components/master-admin/prospects/ProspectKanban.tsx`, `frontend/vite.config.ts` | Placeholder embeds, missing DnD, imagemin disabled | `FRN-032` |
| Cross-Release QA & Coverage | `docs/testing/**`, CI scripts | Need ≥90% coverage + Lighthouse/Axe audits for v1.2 | `QA-095` |

---

## 2. Backend Mapping

| PRD Requirement | Current Implementation | Gap Details | Story |
| --- | --- | --- | --- |
| Financial planning & analytics (PRD §Functional #3) | `backend/app/api/routes/fpa.py` exposes endpoints but bodies are `# TODO` | Demand forecast creation, scenario modeling, report generation not wired to services or persistence | `DEV-022` |
| Document generation & legal exports (PRD §Functional #4) | `backend/app/api/routes/document_generation.py` integrates templates | `created_by` metadata unresolved, background file generation not triggered | `DEV-023` |
| Automation & notifications (PRD §Functional #5) | `backend/app/tasks/campaign_tasks.py` stubs email sending | Email service integration missing; caching tests lacking coverage for HIT/MISS/bypass scenarios | `DEV-024` |

---

## 3. Frontend Mapping

| PRD Requirement | Current Implementation | Gap Details | Story |
| --- | --- | --- | --- |
| Document room permissions & audit logs (PRD §Functional #4) | `frontend/src/pages/documents/DocumentWorkspace.tsx` UI flows exist | Permission mutation, audit log dispatch, confirmation dialog flagged as TODOs | `FRN-030` |
| Bulk actions & dashboard automation (PRD §Functional #5) | `frontend/src/hooks/useBulkActions.ts`, `frontend/src/pages/DashboardPage.tsx` | API calls stubbed; dashboard task widget uses placeholder data | `FRN-031` |
| Valuation narratives & marketing media (PRD §Functional #3 & Marketing scope) | `ValuationSuite.test.tsx`, `PodcastPage.tsx`, `master-admin` prospects | Tests skipped, upgrade errors unhandled, YouTube embed placeholder, Kanban lacks drag/drop, imagemin disabled | `FRN-032` |

---

## 4. Story Backlog

- `DEV-022-backend-fpa-forecasting.md` – implement demand forecasts, scenarios, and reports with services, schemas, and tests.  
- `DEV-023-document-generation-handoff.md` – wire created_by metadata and background file generation for document exports.  
- `DEV-024-automation-cache-hardening.md` – finalize email delivery integration and expand caching tests (HIT/MISS/bypass).  
- `FRN-030-document-workspace-permissions.md` – complete permission/audit flows plus confirmation UX and API wiring.  
- `FRN-031-valuation-dashboard-ux.md` – enable skipped valuation tests, upgrade handling, and real task APIs.  
- `FRN-032-marketing-master-admin-polish.md` – replace marketing embeds, add Kanban DnD, re-enable imagemin.  
- `QA-095-coverage-audit.md` – cross-cutting QA stories for coverage & Lighthouse/Axe enforcement.

All stories should follow BMAD TDD cadence with corresponding entries under `docs/bmad/stories/`.

---

## 5. Next Steps

1. Author story documents (see list above) with acceptance criteria, test plans, and file touchpoints.  
2. Align each story with PRD/architecture references to maintain traceability.  
3. Feed stories into BMAD workflow (`create-story` → `dev-story`) for implementation waves.

---

_Prepared for v1.2 planning and execution. Keep this artifact updated as gaps are closed._

