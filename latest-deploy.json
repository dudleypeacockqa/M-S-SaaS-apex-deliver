[{"deploy":{"id":"dep-d491s6ffte5s73aai0ig","commit":{"id":"ded9734f9dfc4a87fbdb08d8b1bc6f4e261af7c8","message":"fix(migrations): restructure UUID to String migrations and eliminate circular dependencies\n\nFixed critical deployment blocker causing Render backend failures.\n\n**Root Causes:**\n1. Production DB has users.id and organizations.id as UUID type\n2. Models expect String(36) for all ID columns\n3. Pipeline templates migration creates FK to users.id, causing type mismatch\n4. Invalid migration chain structure caused circular dependencies\n\n**Migration Chain Issues:**\n- Old structure: Multiple branching migrations with circular references\n- Old merge c80cbaa32b50 became invalid when parents were updated\n- Migrations e19f4551fcb0 and f5b6c2c9d4f2 had wrong parent references\n\n**Fix Strategy - Restructured Migration Chain:**\n\n**Before (BROKEN):**\n```\nc3a7b4bbf913\n  â”œâ”€â†’ dc2c0f69c1b1 (pipeline templates)\n  â””â”€â†’ 1a11396903e4 (user FK fix)\n       â†“\n  c80cbaa32b50 (merge)\n       â†“\n  0cbf1e0e3ab5 (organizations.id fix)\n```\nProblem: Pipeline templates try to create FK to users.id (UUID) from String(36) column\n\n**After (FIXED):**\n```\nc3a7b4bbf913 (rbac audit logs)\n  â†“\n3a15202c7dc2 (users.id UUID â†’ String) [RUNS FIRST] âœ…\n  â†“\n  â”œâ”€â†’ 0cbf1e0e3ab5 (organizations.id UUID â†’ String) âœ…\n  â””â”€â†’ dc2c0f69c1b1 (pipeline templates - FKs now safe) âœ…\n  â†“\n9a3aba324f7f (merge - single head) âœ…\n```\n\n**Migrations Changed:**\n\n1. **Created:** 3a15202c7dc2_convert_users_id_from_uuid_to_string_.py\n   - Parent: c3a7b4bbf913 (before branching)\n   - Converts users.id from UUID to String(36)\n   - MUST run before any migrations create FKs to users.id\n\n2. **Updated:** 0cbf1e0e3ab5_fix_organizations_id_type_from_uuid_to_.py\n   - Parent: 3a15202c7dc2 (was c80cbaa32b50)\n   - Converts organizations.id from UUID to String(36)\n\n3. **Updated:** dc2c0f69c1b1_add_pipeline_templates.py\n   - Parent: 3a15202c7dc2 (was c3a7b4bbf913)\n   - Creates pipeline_templates and pipeline_template_stages tables\n   - FKs to users.id and organizations.id now safe (both String(36))\n\n4. **Created:** 9a3aba324f7f_merge_organizations_and_pipeline_.py\n   - Merge migration to reconcile both UUID fix branches\n   - Single head for deployment\n\n**Deleted (Invalid/Obsolete):**\n- c80cbaa32b50_merge_pipeline_templates_and_user_fk_.py (invalid merge)\n- 1a11396903e4_fix_user_foreign_key_types_in_document_.py (wrong parent)\n- e19f4551fcb0_fix_users_id_type_to_string.py (duplicate/wrong parent)\n- f5b6c2c9d4f2_merge_uuid_heads.py (invalid merge)\n\n**Frontend Changes:**\n- Added pipeline template hooks (frontend/src/hooks/pipelineTemplates.ts)\n- Added pipeline template API service (frontend/src/services/api/pipelineTemplates.ts)\n- Updated DealKanbanBoard.tsx for pipeline template integration\n\n**Verification:**\n- `alembic heads` shows single head: 9a3aba324f7f âœ…\n- `alembic history` shows correct chain with no cycles âœ…\n- Migration order ensures users.id and organizations.id are converted BEFORE dependent tables âœ…\n\n**Expected Deployment Outcome:**\nWhen Render runs `alembic upgrade head`:\n1. users.id converts to String(36) first (3a15202c7dc2)\n2. Then organizations.id converts (0cbf1e0e3ab5) and pipeline_templates are created (dc2c0f69c1b1)\n3. Then merge migration applies (9a3aba324f7f)\n4. All FK constraints will match types âœ…\n5. No \"incompatible types\" errors âœ…\n\nThis should resolve the 3 consecutive deployment failures.\n\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude \u003cnoreply@anthropic.com\u003e","createdAt":"2025-11-10T17:17:00Z"},"status":"update_in_progress","trigger":"new_commit","createdAt":"2025-11-10T17:17:17.85608Z","updatedAt":"2025-11-10T17:18:05.28071Z","startedAt":"2025-11-10T17:17:17.80515Z"},"cursor":"CJNszD6SFIxzNmZmdGU1czczYWFpMGln"}]
